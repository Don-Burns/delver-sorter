<!DOCTYPE html>
<html>

<head>
    <title>Card List</title>
    <style>
        .red-highlight {
            background-color: #FFCECE;
            /* Light red highlight */
        }

        table {
            border-collapse: collapse;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
        }

        th {
            background-color: #f2f2f2;
        }

        .asc:after {
            content: " \25B2";
            /* Black up-pointing triangle */
        }

        .desc:after {
            content: " \25BC";
            /* Black down-pointing triangle */
        }
    </style>
</head>

<body>
    <select id="sortColumns" multiple>
        <option value="name_asc">Card Name (Ascending)</option>
        <option value="name_desc">Card Name (Descending)</option>
        <option value="cmc_asc">CMC (Ascending)</option>
        <option value="cmc_desc">CMC (Descending)</option>
        <option value="color_asc">Color ID (Ascending)</option>
        <option value="color_desc">Color ID (Descending)</option>
        <option value="owned_asc">Owned (Ascending)</option>
        <option value="owned_desc">Owned (Descending)</option>
        <option value="incoming_asc">Incoming (Ascending)</option>
        <option value="incoming_desc">Incoming (Descending)</option>
    </select>

    <table>
        <thead>
            <tr>
                <th>Card Name</th>
                <th>CMC</th>
                <th>Color ID</th>
                <th>Mana Cost</th>
                <th>Owned</th>
                <th>Incoming</th>
            </tr>
        </thead>
        <tbody>
            {% for card in cards %}
            <tr class="{% if card.owned is none %}red-highlight{% endif %}">
                <td>{{ card.card_name }}</td>
                <td>{{ card.cmc }}</td>
                <td>{{ card.color_id }}</td>
                <td>{{ card.mana_cost }}</td>
                <td>{% if card.owned %}{{ card.owned }}{% else %}Not Owned{% endif %}</td>
                <td>{% if card.incoming %}{{ card.incoming }}{% else %}N/A{% endif %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        const sortColumns = document.getElementById('sortColumns');

        sortColumns.addEventListener('change', () => {
            const selectedSorts = Array.from(sortColumns.selectedOptions).map(option => option.value);

            const table = document.getElementsByTagName("table")[0];
            const rows = Array.from(table.rows).slice(1); // Exclude header row

            rows.sort((a, b) => {
                for (const selectedSort of selectedSorts) {
                    let comparison = 0;
                    const [column, order] = selectedSort.split('_');

                    switch (column) {
                        case 'name':
                            comparison = order === 'asc' ? a.cells[0].innerHTML.localeCompare(b.cells[0].innerHTML) : b.cells[0].innerHTML.localeCompare(a.cells[0].innerHTML);
                            break;
                        case 'cmc':
                            comparison = order === 'asc' ? a.cells[1].innerHTML - b.cells[1].innerHTML : b.cells[1].innerHTML - a.cells[1].innerHTML;
                            break;
                        case 'color':
                            comparison = order === 'asc' ? a.cells[2].innerHTML.localeCompare(b.cells[2].innerHTML) : b.cells[2].innerHTML.localeCompare(a.cells[2].innerHTML);
                            break;
                        case 'owned':
                            // Handle potential "Not Owned" string
                            const ownedA = a.cells[4].innerHTML === "Not Owned" ? 0 : parseInt(a.cells[4].innerHTML);
                            const ownedB = b.cells[4].innerHTML === "Not Owned" ? 0 : parseInt(b.cells[4].innerHTML);
                            comparison = order === 'asc' ? ownedA - ownedB : ownedB - ownedA;
                            break;
                        case 'incoming':
                            // Handle potential "N/A" string
                            const incomingA = a.cells[5].innerHTML === "N/A" ? 0 : parseInt(a.cells[5].innerHTML);
                            const incomingB = b.cells[5].innerHTML === "N/A" ? 0 : parseInt(b.cells[5].innerHTML);
                            comparison = order === 'asc' ? incomingA - incomingB : incomingB - incomingA;
                            break;
                    }

                    if (comparison !== 0) {
                        return comparison;
                    }
                }

                return 0; // If all sorted columns are equal, maintain original order
            });

            // Re-insert sorted rows
            for (const row of rows) {
                table.tBodies[0].appendChild(row);
            }
        });
    </script>
</body>

</html>
