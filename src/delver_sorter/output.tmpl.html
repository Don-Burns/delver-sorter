<!DOCTYPE html>
<html>

<head>
    <title>Card List</title>
    <style>
        .red-highlight {
            background-color: #FFCECE;
            /* Light red highlight */
        }

        table {
            border-collapse: collapse;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
        }

        th {
            background-color: #f2f2f2;
            cursor: pointer;
        }

        .asc:after {
            content: " \25B2";
            /* Black up-pointing triangle */
        }

        .desc:after {
            content: " \25BC";
            /* Black down-pointing triangle */
        }
    </style>
</head>

<body>
    <table>
        <thead>
            <tr>
                <th onclick="sortTable(0, this)">Card Name</th>
                <th onclick="sortTable(1, this)">CMC</th>
                <th onclick="sortTable(2, this)">Color ID</th>
                <th onclick="sortTable(3, this)">Mana Cost</th>
                <th onclick="sortTable(4, this)">Owned</th>
                <th onclick="sortTable(5, this)">Incoming</th>
            </tr>
        </thead>
        <tbody>
            {% for card in cards %}
            <tr class="{% if card.owned is none %}red-highlight{% endif %}">
                <td>{{ card.card_name }}</td>
                <td>{{ card.cmc }}</td>
                <td>{{ card.color_id }}</td>
                <td>{{ card.mana_cost }}</td>
                <td>{% if card.owned %}{{ card.owned }}{% else %}Not Owned{% endif %}</td>
                <td>{% if card.incoming %}{{ card.incoming }}{% else %}N/A{% endif %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        let sortOrder = []; // Array to store sort order for each column (asc/desc)

        function sortTable(n, th) {
            // Clear previous sort order indicators
            for (let i = 0; i < th.parentNode.cells.length; i++) {
                th.parentNode.cells[i].classList.remove("asc");
                th.parentNode.cells[i].classList.remove("desc");
            }

            // Toggle sort order
            if (sortOrder[n] === 'asc') {
                sortOrder[n] = 'desc';
                th.classList.add("desc");
            } else {
                sortOrder[n] = 'asc';
                th.classList.add("asc");
            }

            // Perform the sort
            const table = document.getElementsByTagName("table")[0];
            const rows = Array.from(table.rows).slice(1); // Exclude header row

            rows.sort((a, b) => {
                const cellA = a.cells[n];
                const cellB = b.cells[n];
                const valueA = cellA.innerHTML.toLowerCase();
                const valueB = cellB.innerHTML.toLowerCase();

                if (sortOrder[n] === 'asc') {
                    return valueA.localeCompare(valueB);
                } else {
                    return valueB.localeCompare(valueA);
                }
            });

            // Re-insert sorted rows
            for (const row of rows) {
                table.tBodies[0].appendChild(row);
            }
        }
    </script>
</body>

</html>
